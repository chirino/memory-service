# Set a dummy OpenAI API key for tests (not actually used in these tests)
quarkus.langchain4j.openai.api-key=${OPENAI_API_KEY:test-openai-key}

# Configure REST client to use dynamic test server URL
# This will be overridden by the test to use the actual test server URL
#openapi_yml/mp-rest/url=${test.url:http://localhost:8081}

# Configure AgentConversationsApi REST client to use dynamic test server URL
# The ${test.url} property is automatically set by Quarkus to the test server URL
quarkus.rest-client.memory-service-client.url=${test.url:http://localhost:8081}
quarkus.oidc.enabled=true

# Test API keys (can be used in tests that exercise API key paths)
# Disable container reuse so a fresh database (with up-to-date schema) is created each run
%test.quarkus.datasource.devservices.reuse=false

%test.memory-service.api-keys.test-agent=test-agent-key
%test.memory-service.api-keys.agent-b=test-agent-key-b
%test.memory-service.api-keys.agent-c=test-agent-key-c
%test.quarkus.oidc.application-type=service
%test.memory-service.vector.store.type=pgvector
# Use local embedding model during tests - JVM forking (reuseForks=false) prevents
# native library classloader conflicts between test classes
%test.memory-service.embedding.type=local

# Eviction: small batch size to exercise multi-batch loop, no delay for speed
%test.memory-service.eviction.batch-size=10
%test.memory-service.eviction.batch-delay-ms=0

# Pre-configure Keycloak Dev Services users for testing
# Format: username=password (users are created with their username as password by default)
%test.quarkus.keycloak.devservices.users.alice=alice
%test.quarkus.keycloak.devservices.users.bob=bob
%test.quarkus.keycloak.devservices.users.charlie=charlie
%test.quarkus.keycloak.devservices.users.dave=dave

# Assign roles for testing
%test.quarkus.keycloak.devservices.roles.alice=admin
%test.quarkus.keycloak.devservices.roles.charlie=auditor
%test.quarkus.keycloak.devservices.roles.dave=indexer

# Role configuration for tests
%test.memory-service.roles.admin.oidc.role=admin
%test.memory-service.roles.auditor.oidc.role=auditor
%test.memory-service.roles.indexer.oidc.role=indexer

# Use random ports to avoid conflicts with other running services
%test.quarkus.http.test-port=0

# Ensure gRPC tests talk to the in-process gRPC server (shares HTTP port)
%test.quarkus.grpc.server.enabled=true
%test.quarkus.grpc.server.use-separate-server=false
%test.quarkus.grpc.server.host=localhost

# Configure Prometheus for admin stats tests (mock will be used)
%test.memory-service.prometheus.url=http://mock-prometheus:9090

# Suppress verbose logging during tests - only show errors
%test.quarkus.log.level=ERROR
%test.quarkus.log.category."io.github.chirino.memory".level=ERROR
%test.quarkus.log.category."io.github.chirino.memory.response".level=INFO
%test.quarkus.log.category."io.quarkus".level=ERROR
%test.quarkus.log.category."org.jboss".level=ERROR
%test.quarkus.log.console.enable=true
%test.quarkus.log.console.format=%d{HH:mm:ss.SSS} %-5p [%c{2.}] %s%e%n
