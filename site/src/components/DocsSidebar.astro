---
const basePath = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname;

interface NavItem {
  label: string;
  href: string;
}

interface NavSection {
  title: string;
  items: NavItem[];
}

const navigation: NavSection[] = [
  {
    title: 'Getting Started',
    items: [
      { label: 'Overview', href: '/docs/' },
      { label: 'Quick Start', href: '/docs/getting-started/' },
      { label: 'Service Configuration', href: '/docs/configuration/' },
    ],
  },
  {
    title: 'Core Concepts',
    items: [
      { label: 'Conversations', href: '/docs/concepts/conversations/' },
      { label: 'Entries', href: '/docs/concepts/entries/' },
      { label: 'Forking', href: '/docs/concepts/forking/' },
      
    ],
  },
  {
    title: 'Quarkus',
    items: [
      { label: 'Getting Started', href: '/docs/quarkus/getting-started/' },
      { label: 'Conversation History', href: '/docs/quarkus/conversation-history/' },
      { label: 'Advanced Features', href: '/docs/quarkus/advanced-features/' },
      { label: 'Dev Services', href: '/docs/quarkus/dev-services/' },
      // { label: 'Overview', href: '/docs/quarkus/overview/' },
      // { label: 'REST Client', href: '/docs/quarkus/rest-client/' },
      // { label: 'gRPC Client', href: '/docs/quarkus/grpc-client/' },
      // { label: 'LangChain4j', href: '/docs/quarkus/langchain4j/' },
    ],
  },
  {
    title: 'Spring',
    items: [
      { label: 'Getting Started', href: '/docs/spring/getting-started/' },
      { label: 'Conversation History', href: '/docs/spring/conversation-history/' },
      { label: 'Advanced Features', href: '/docs/spring/advanced-features/' },
      { label: 'Docker Compose', href: '/docs/spring/docker-compose/' },
    ],
  },
  // {
  //   title: 'Deployment',
  //   items: [
  //     { label: 'Docker', href: '/docs/deployment/docker/' },
  //     { label: 'Kubernetes', href: '/docs/deployment/kubernetes/' },
  //     { label: 'Database Setup', href: '/docs/deployment/databases/' },
  //   ],
  // },
  {
    title: 'Reference',
    items: [
      { label: 'API Contracts', href: '/docs/api-contracts/' },
      { label: 'FAQ', href: '/docs/faq/' },
      { label: 'Changelog', href: '/docs/changelog/' },
      { label: 'Versions', href: '/docs/versions/' },
    ],
  },
];

function getFullHref(href: string) {
  return basePath + href.slice(1);
}

function isActive(href: string) {
  const fullHref = getFullHref(href);
  // Exact match for root docs page
  if (href === '/docs/') {
    return currentPath === fullHref || currentPath === fullHref.slice(0, -1);
  }
  // Prefix match for others
  return currentPath.startsWith(fullHref);
}
---

<nav class="px-4 pb-8" aria-label="Documentation navigation">
  {navigation.map(section => (
    <div class="sidebar-section">
      <h3 class="sidebar-heading">{section.title}</h3>
      <ul class="space-y-1">
        {section.items.map(item => (
          <li>
            <a
              href={getFullHref(item.href)}
              class:list={[
                'sidebar-link',
                isActive(item.href) && 'sidebar-link-active',
              ]}
              aria-current={isActive(item.href) ? 'page' : undefined}
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  ))}
</nav>
