---
const basePath = import.meta.env.BASE_URL;
const currentPath = Astro.url.pathname;

interface NavItem {
  label: string;
  href: string;
}

interface NavSection {
  title: string;
  items: NavItem[];
}

const navigation: NavSection[] = [
  {
    title: 'Getting Started',
    items: [
      { label: 'Overview', href: '/docs/' },
      { label: 'Quick Start', href: '/docs/getting-started/' },
      { label: 'Configuration', href: '/docs/configuration/' },
    ],
  },
  {
    title: 'Core Concepts',
    items: [
      { label: 'Conversations', href: '/docs/concepts/conversations/' },
      { label: 'Messages', href: '/docs/concepts/messages/' },
      { label: 'Forking', href: '/docs/concepts/forking/' },
      { label: 'Semantic Search', href: '/docs/concepts/semantic-search/' },
    ],
  },
  {
    title: 'Integrations',
    items: [
      { label: 'Quarkus Extension', href: '/docs/integrations/quarkus/' },
      { label: 'LangChain4j', href: '/docs/integrations/langchain4j/' },
      { label: 'REST API', href: '/docs/integrations/rest-api/' },
      { label: 'gRPC API', href: '/docs/integrations/grpc/' },
    ],
  },
  {
    title: 'Deployment',
    items: [
      { label: 'Docker', href: '/docs/deployment/docker/' },
      { label: 'Kubernetes', href: '/docs/deployment/kubernetes/' },
      { label: 'Database Setup', href: '/docs/deployment/databases/' },
    ],
  },
  {
    title: 'Reference',
    items: [
      { label: 'FAQ', href: '/docs/faq/' },
      { label: 'Changelog', href: '/docs/changelog/' },
      { label: 'Versions', href: '/docs/versions/' },
    ],
  },
];

function getFullHref(href: string) {
  return basePath + href.slice(1);
}

function isActive(href: string) {
  const fullHref = getFullHref(href);
  // Exact match for root docs page
  if (href === '/docs/') {
    return currentPath === fullHref || currentPath === fullHref.slice(0, -1);
  }
  // Prefix match for others
  return currentPath.startsWith(fullHref);
}
---

<nav class="px-4 pb-8" aria-label="Documentation navigation">
  {navigation.map(section => (
    <div class="sidebar-section">
      <h3 class="sidebar-heading">{section.title}</h3>
      <ul class="space-y-1">
        {section.items.map(item => (
          <li>
            <a
              href={getFullHref(item.href)}
              class:list={[
                'sidebar-link',
                isActive(item.href) && 'sidebar-link-active',
              ]}
              aria-current={isActive(item.href) ? 'page' : undefined}
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  ))}
</nav>
