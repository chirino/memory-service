---
layout: ../../../layouts/DocsLayout.astro
title: Conversation Forking
description: Branch conversations to explore alternative paths.
---
import CodeFromFile from '../../../components/CodeFromFile.astro';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide covers conversation forking â€” letting users branch off from any point in a conversation to explore alternative paths.

> **New to forking concepts?**
> Read [Forking](/docs/concepts/forking/) first to understand how conversation forking works. This guide focuses on the Quarkus implementation.

## Prerequisites

**Starting checkpoint**: This guide starts from [quarkus/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/quarkus/examples/doc-checkpoints/03-with-history)

Make sure you've completed the previous guides:
- [Getting Started](/docs/quarkus/getting-started/) - Basic memory service integration
- [Conversation History](/docs/quarkus/conversation-history/) - History recording and APIs

## Conversation Forking

Conversation forking lets users branch off from any point in a conversation to explore alternative paths.

### How Forking Works

Forks are created implicitly when the first entry is appended to a new conversation with fork metadata. In this checkpoint, `HistoryRecordingAgent` remains the same as the previous step, and fork metadata is passed when creating entries through the Memory Service API:

<CodeFromFile
  file="quarkus/examples/doc-checkpoints/04-conversation-forking/src/main/java/org/acme/HistoryRecordingAgent.java"
  lang="java"
/>

### Listing Forks

Add this method to `ConversationsResource.java` to list forks for a conversation:

<CodeFromFile
  file="quarkus/examples/doc-checkpoints/04-conversation-forking/src/main/java/org/acme/ConversationsResource.java"
  lang="java"
  before={2}
  after={1}
>public Response listConversationForks</CodeFromFile>

## Try It With Curl

<TestScenario checkpoint="quarkus/examples/doc-checkpoints/04-conversation-forking">

Define a helper to get a bearer token for `bob`:

```bash
function get-token() {
  curl -sSfX POST http://localhost:8081/realms/memory-service/protocol/openid-connect/token \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "client_id=memory-service-client" \
    -d "client_secret=change-me" \
    -d "grant_type=password" \
    -d "username=bob" \
    -d "password=bob" \
    | jq -r '.access_token'
}
```

Create a turn on the source conversation:

<CurlTest steps={`
Then the response status should be 200
`}>

```bash
curl -NsSfX POST http://localhost:9090/chat/2c9d7ab0-b842-4b08-91b0-9dc6f4825f01 \
  -H "Content-Type: text/plain" \
  -H "Authorization: Bearer $(get-token)" \
  -d "Hello from the root conversation."
```

</CurlTest>

Example response:

```text
Sure, I can help with that.
```

Fetch the entry id to fork from:

<CurlTest steps={`
Then the response status should be 200
And set "FORK_ENTRY_ID" to the json response field "data[1].id"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/2c9d7ab0-b842-4b08-91b0-9dc6f4825f01/entries \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response from the entries API:

```json
{
  "data": [
    {
      "id": "9dded20f-4118-4d7a-b633-141311ec589e",
      "conversationId": "2c9d7ab0-b842-4b08-91b0-9dc6f4825f01",
      "channel": "history",
      "contentType": "history",
      "content": [{"role": "USER", "text": "Hello from the root conversation."}]
    }
  ]
}
```

Create a forked entry (this uses the Memory Service API directly so fork metadata can be passed in the request body).
Use a different conversation ID in the path (`5deea4ab-32d4-4587-b1c1-3e5707eb596f` below) than the root conversation ID:

<CurlTest steps={`
Then the response status should be 201
`}>

```bash
curl -sSfX POST http://localhost:8082/v1/conversations/5deea4ab-32d4-4587-b1c1-3e5707eb596f/entries \
  -H "Authorization: Bearer $(get-token)" \
  -H "X-API-Key: agent-api-key-1" \
  -H "Content-Type: application/json" \
  -d '{
    "channel": "history",
    "contentType": "history",
    "content": [{"role": "USER", "text": "Continue from this fork."}],
    "forkedAtConversationId": "2c9d7ab0-b842-4b08-91b0-9dc6f4825f01",
    "forkedAtEntryId": "${FORK_ENTRY_ID}"
  }' | jq
```

</CurlTest>

Example response:

```json
{
  "id": "b3a9d6dd-b499-44cc-8852-1d2dbab6f03c",
  "conversationId": "5deea4ab-32d4-4587-b1c1-3e5707eb596f",
  "channel": "history",
  "contentType": "history",
  "content": [{"role": "USER", "text": "Continue from this fork."}]
}
```

List forks for the source conversation through the Quarkus proxy endpoint:

<CurlTest steps={`
Then the response status should be 200
And the response should contain "2c9d7ab0-b842-4b08-91b0-9dc6f4825f01"
And the response should contain "5deea4ab-32d4-4587-b1c1-3e5707eb596f"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/2c9d7ab0-b842-4b08-91b0-9dc6f4825f01/forks \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "data": [
    {
      "conversationId": "2c9d7ab0-b842-4b08-91b0-9dc6f4825f01",
      "title": "Hello from the root conversation.",
      "createdAt": "2026-02-23T03:56:55.880524Z"
    },
    {
      "conversationId": "5deea4ab-32d4-4587-b1c1-3e5707eb596f",
      "forkedAtConversationId": "2c9d7ab0-b842-4b08-91b0-9dc6f4825f01",
      "title": "Continue from this fork.",
      "createdAt": "2026-02-23T03:57:31.598799Z"
    }
  ],
  "afterCursor": null
}
```

</TestScenario>

## Complete Example

**Completed code**: View the full implementation at [quarkus/examples/doc-checkpoints/04-conversation-forking](https://github.com/chirino/memory-service/tree/main/quarkus/examples/doc-checkpoints/04-conversation-forking)

For a complete working example with frontend, see the [quarkus/examples/chat-quarkus](https://github.com/chirino/memory-service/tree/main/quarkus/examples/chat-quarkus) directory in the repository.

## Next Steps

- [Response Resumption](/docs/quarkus/response-resumption/) - Streaming responses with resume and cancel support.
- [Conversation Sharing](/docs/quarkus/sharing/) - Share conversations with other users.
- [Dev Services](/docs/quarkus/dev-services/) - Automatic memory-service container startup for development and testing.
