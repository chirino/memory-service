---
layout: ../../../layouts/DocsLayout.astro
title: Conversation Forking
description: Branch conversations to explore alternative paths.
---
import { Code } from 'astro:components';
import { PROJECT_VERSION } from '../../../config';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide covers conversation forking â€” letting users branch off from any point in a conversation to explore alternative paths.

> **New to forking concepts?**
> Read [Forking](/docs/concepts/forking/) first to understand how conversation forking works. This guide focuses on the Spring implementation.

## Prerequisites

**Starting checkpoint**: This guide starts from [spring/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/03-with-history)

Make sure you've completed the previous guides:
- [Getting Started](/docs/spring/getting-started/) - Basic memory service integration
- [Conversation History](/docs/spring/conversation-history/) - History recording and APIs

## Conversation Forking

Conversation forking lets users branch off from any point in a conversation to explore alternative paths. Add these methods to the `MemoryServiceProxyController` to enable forking and listing forks:

```java
@PostMapping("/{conversationId}/entries/{entryId}/fork")
public ResponseEntity<?> forkConversationAtEntry(
        @PathVariable String conversationId,
        @PathVariable String entryId,
        @RequestBody(required = false) String body) {
    return proxy.forkConversationAtEntry(conversationId, entryId, body);
}

@GetMapping("/{conversationId}/forks")
public ResponseEntity<?> listConversationForks(@PathVariable String conversationId) {
    return proxy.listConversationForks(conversationId);
}
```

The fork endpoint creates a new conversation that:
- Copies all entries up to and excluding the specified entry
- Creates a new conversation ID for the fork
- Links the fork back to the original conversation

Test it with curl:

```bash
# Get the id of the first entry in the conversation
FIRST_ENTRY_ID=$(curl -sSfX GET http://localhost:9090/v1/conversations/3579aac5-c86e-4b67-bbea-6ec1a3644942/entries \
  -H "Authorization: Bearer $(get-token)" | jq -r '.data[0].id')

curl -sSfX POST http://localhost:9090/v1/conversations/3579aac5-c86e-4b67-bbea-6ec1a3644942/entries/$FIRST_ENTRY_ID/fork \
  -H "Authorization: Bearer $(get-token)" \
  -H "Content-Type: application/json" \
  -d '{"title": "Alternative approach"}' | jq
```

This will create a new conversation with the `forkedAtConversationId` set to the original conversation ID and the title "Alternative approach", but with a new conversation ID.

## Complete Example

**Completed code**: View the full implementation at [spring/examples/doc-checkpoints/04-conversation-forking](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/04-conversation-forking)

For a complete working example with frontend, see the [spring/examples/chat-spring](https://github.com/chirino/memory-service/tree/main/spring/examples/chat-spring) directory in the repository.

## Next Steps

- [Response Resumption](/docs/spring/response-resumption/) - Streaming responses with resume and cancel support.
- [Conversation Sharing](/docs/spring/sharing/) - Share conversations with other users.
- [Docker Compose Integration](/docs/spring/docker-compose/) - Automatic memory-service container startup for development and testing.
