---
layout: ../../../layouts/DocsLayout.astro
title: Conversation Forking
description: Branch conversations to explore alternative paths.
---
import { Code } from 'astro:components';
import { PROJECT_VERSION } from '../../../config';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide covers conversation forking â€” letting users branch off from any point in a conversation to explore alternative paths.

> **New to forking concepts?**
> Read [Forking](/docs/concepts/forking/) first to understand how conversation forking works. This guide focuses on the Spring implementation.

## Prerequisites

**Starting checkpoint**: This guide starts from [spring/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/03-with-history)

Make sure you've completed the previous guides:
- [Getting Started](/docs/spring/getting-started/) - Basic memory service integration
- [Conversation History](/docs/spring/conversation-history/) - History recording and APIs

## Conversation Forking

Conversation forking lets users branch off from any point in a conversation to explore alternative paths.

### Listing Forks

Add this method to the `MemoryServiceProxyController` to list forks for a conversation:

```java
@GetMapping("/{conversationId}/forks")
public ResponseEntity<?> listConversationForks(@PathVariable String conversationId) {
    return proxy.listConversationForks(conversationId);
}
```

### How Forking Works

Forks are created implicitly when the first entry is appended to a new conversation with fork metadata. In Spring, the `ConversationHistoryStreamAdvisor` reads fork metadata from advisor params and includes it in the entry request.

Pass fork metadata from your controller using the advisor param keys:

```java
import static io.github.chirino.memoryservice.history.ConversationHistoryStreamAdvisor.FORKED_AT_CONVERSATION_ID_KEY;
import static io.github.chirino.memoryservice.history.ConversationHistoryStreamAdvisor.FORKED_AT_ENTRY_ID_KEY;

// In your chat/stream handler:
if (StringUtils.hasText(request.getForkedAtConversationId())) {
    advisor.param(FORKED_AT_CONVERSATION_ID_KEY, request.getForkedAtConversationId());
}
if (StringUtils.hasText(request.getForkedAtEntryId())) {
    advisor.param(FORKED_AT_ENTRY_ID_KEY, request.getForkedAtEntryId());
}
```

When the frontend sends a chat request with fork metadata, the advisor includes `forkedAtConversationId` and `forkedAtEntryId` in the `CreateEntryRequest`. If the target conversation doesn't exist yet, the memory service auto-creates it as a fork of the original conversation at the specified entry.

## Complete Example

**Completed code**: View the full implementation at [spring/examples/doc-checkpoints/04-conversation-forking](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/04-conversation-forking)

For a complete working example with frontend, see the [spring/examples/chat-spring](https://github.com/chirino/memory-service/tree/main/spring/examples/chat-spring) directory in the repository.

## Next Steps

- [Response Resumption](/docs/spring/response-resumption/) - Streaming responses with resume and cancel support.
- [Conversation Sharing](/docs/spring/sharing/) - Share conversations with other users.
- [Docker Compose Integration](/docs/spring/docker-compose/) - Automatic memory-service container startup for development and testing.
