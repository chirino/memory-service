---
layout: ../../../layouts/DocsLayout.astro
title: Conversation Forking
description: Branch conversations to explore alternative paths.
---
import CodeFromFile from '../../../components/CodeFromFile.astro';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide covers conversation forking â€” letting users branch off from any point in a conversation to explore alternative paths.

> **New to forking concepts?**
> Read [Forking](/docs/concepts/forking/) first to understand how conversation forking works. This guide focuses on the Spring implementation.

## Prerequisites

**Starting checkpoint**: This guide starts from [spring/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/03-with-history)

Make sure you've completed the previous guides:
- [Getting Started](/docs/spring/getting-started/) - Basic memory service integration
- [Conversation History](/docs/spring/conversation-history/) - History recording and APIs

## Conversation Forking

Conversation forking lets users branch off from any point in a conversation to explore alternative paths.

### How Forking Works

Forks are created implicitly when the first entry is appended to a new conversation with fork metadata. In this checkpoint, the `ChatController` remains the same as the previous step, and fork metadata is passed when creating entries through the Memory Service API:

<CodeFromFile
  file="spring/examples/doc-checkpoints/04-conversation-forking/src/main/java/com/example/demo/ChatController.java"
  lang="java"
  before={2}
  after={1}
>public String chat(@PathVariable String conversationId, @RequestBody String message)</CodeFromFile>

### Listing Forks

Add this method to the `MemoryServiceProxyController` to list forks for a conversation:

<CodeFromFile
  file="spring/examples/doc-checkpoints/04-conversation-forking/src/main/java/com/example/demo/MemoryServiceProxyController.java"
  lang="java"
  before={2}
  after={1}
>listConversationForks(@PathVariable String conversationId)</CodeFromFile>

## Try It With Curl

<TestScenario checkpoint="spring/examples/doc-checkpoints/04-conversation-forking">

Define a helper to get a bearer token for `bob`:

```bash
function get-token() {
  curl -sSfX POST http://localhost:8081/realms/memory-service/protocol/openid-connect/token \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "client_id=memory-service-client" \
    -d "client_secret=change-me" \
    -d "grant_type=password" \
    -d "username=bob" \
    -d "password=bob" \
    | jq -r '.access_token'
}
```

Create a turn on the source conversation:

<CurlTest steps={`
Then the response status should be 200
`}>

```bash
curl -NsSfX POST http://localhost:9090/chat/a8391789-592d-4273-90df-7349b08b5d3d \
  -H "Content-Type: text/plain" \
  -H "Authorization: Bearer $(get-token)" \
  -d "Hello from the root conversation."
```

</CurlTest>

Example response:

```text
Sure, I can help with that.
```

Fetch the entry id to fork from:

<CurlTest steps={`
Then the response status should be 200
And set "FORK_ENTRY_ID" to the json response field "data[1].id"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/a8391789-592d-4273-90df-7349b08b5d3d/entries \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response from the entries API:

```json
{
  "data": [
    {
      "id": "9dded20f-4118-4d7a-b633-141311ec589e",
      "conversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "channel": "history",
      "contentType": "history",
      "content": [{"role": "USER", "text": "Hello from the root conversation."}]
    }
  ]
}
```

Create a forked entry (this uses the Memory Service API directly so fork metadata can be passed in the request body).
Use a different conversation ID in the path (`6dcb8f3f-bd21-459f-9127-96e5a94d276c` below) than the root conversation ID:

<CurlTest steps={`
Then the response status should be 201
`}>

```bash
curl -sSfX POST http://localhost:8082/v1/conversations/6dcb8f3f-bd21-459f-9127-96e5a94d276c/entries \
  -H "Authorization: Bearer $(get-token)" \
  -H "X-API-Key: agent-api-key-1" \
  -H "Content-Type: application/json" \
  -d '{
    "channel": "history",
    "contentType": "history",
    "content": [{"role": "USER", "text": "Continue from this fork."}],
    "forkedAtConversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
    "forkedAtEntryId": "${FORK_ENTRY_ID}"
  }' | jq
```

</CurlTest>

Example response:

```json
{
  "id": "b3a9d6dd-b499-44cc-8852-1d2dbab6f03c",
  "conversationId": "6dcb8f3f-bd21-459f-9127-96e5a94d276c",
  "channel": "history",
  "contentType": "history",
  "content": [{"role": "USER", "text": "Continue from this fork."}]
}
```

List forks for the source conversation through the Spring proxy endpoint:

<CurlTest steps={`
Then the response status should be 200
And the response should contain "a8391789-592d-4273-90df-7349b08b5d3d"
And the response should contain "6dcb8f3f-bd21-459f-9127-96e5a94d276c"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/a8391789-592d-4273-90df-7349b08b5d3d/forks \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "data": [
    {
      "conversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "title": "Hello from the root conversation.",
      "createdAt": "2026-02-23T03:56:55.880524Z"
    },
    {
      "conversationId": "6dcb8f3f-bd21-459f-9127-96e5a94d276c",
      "forkedAtConversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "title": "Continue from this fork.",
      "createdAt": "2026-02-23T03:57:31.598799Z"
    }
  ],
  "afterCursor": null
}
```

</TestScenario>

## Complete Example

**Completed code**: View the full implementation at [spring/examples/doc-checkpoints/04-conversation-forking](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/04-conversation-forking)

For a complete working example with frontend, see the [spring/examples/chat-spring](https://github.com/chirino/memory-service/tree/main/spring/examples/chat-spring) directory in the repository.

## Next Steps

- [Response Resumption](/docs/spring/response-resumption/) - Streaming responses with resume and cancel support.
- [Conversation Sharing](/docs/spring/sharing/) - Share conversations with other users.
- [Docker Compose Integration](/docs/spring/docker-compose/) - Automatic memory-service container startup for development and testing.
