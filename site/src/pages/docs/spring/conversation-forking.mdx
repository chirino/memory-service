---
layout: ../../../layouts/DocsLayout.astro
title: Conversation Forking
description: Branch conversations to explore alternative paths.
---
import CodeFromFile from '../../../components/CodeFromFile.astro';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide covers conversation forking â€” letting users branch off from any point in a conversation to explore alternative paths.

> **New to forking concepts?**
> Read [Forking](/docs/concepts/forking/) first to understand how conversation forking works. This guide focuses on the Spring implementation.

## Prerequisites

**Starting checkpoint**: This guide starts from [spring/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/03-with-history)

Make sure you've completed the previous guides:
- [Getting Started](/docs/spring/getting-started/) - Basic memory service integration
- [Conversation History](/docs/spring/conversation-history/) - History recording and APIs

## Conversation Forking

### How Forking Works

Forks are created implicitly when the first entry is appended to a new conversation with fork metadata. In this checkpoint, the `ChatController` remains the same as the previous step, and fork metadata is passed when creating entries through the Memory Service API:

<CodeFromFile
  file="spring/examples/doc-checkpoints/04-conversation-forking/src/main/java/com/example/demo/ChatController.java"
  lang="java"
  before={2}
  after={1}
>public String chat(@PathVariable String conversationId, @RequestBody String message)</CodeFromFile>

**Why**: Keeping fork metadata out of the controller keeps the chat endpoint simple and generic. The forking relationship is stored by the Memory Service when the first history entry is written with the fork fields populated, so the same `ChatController` can serve both root conversations and forks without branching logic.

### Listing Forks

Add this method to the `MemoryServiceProxyController` to list forks for a conversation:

<CodeFromFile
  file="spring/examples/doc-checkpoints/04-conversation-forking/src/main/java/com/example/demo/MemoryServiceProxyController.java"
  lang="java"
  before={2}
  after={1}
>listConversationForks(@PathVariable String conversationId)</CodeFromFile>

**What changed**: A new `GET /{conversationId}/forks` endpoint is added to `MemoryServiceProxyController`, delegating to `proxy.listConversationForks()`.

**Why**: Frontend UIs need to discover all conversations that branched off from a given point so they can render a fork tree or allow users to navigate between branches. Exposing this as a proxied endpoint keeps the Memory Service behind your Spring Boot app while giving the frontend everything it needs to build a branching conversation UI.

## Try It With Curl

<TestScenario checkpoint="spring/examples/doc-checkpoints/04-conversation-forking">

Define a helper to get a bearer token for `bob`:

```bash
function get-token() {
  curl -sSfX POST http://localhost:8081/realms/memory-service/protocol/openid-connect/token \
    -H "Content-Type: application/x-www-form-urlencoded" \
    -d "client_id=memory-service-client" \
    -d "client_secret=change-me" \
    -d "grant_type=password" \
    -d "username=bob" \
    -d "password=bob" \
    | jq -r '.access_token'
}
```

Create a turn on the source conversation:

<CurlTest steps={`
Then the response status should be 200
`}>

```bash
curl -NsSfX POST http://localhost:9090/chat/a8391789-592d-4273-90df-7349b08b5d3d \
  -H "Content-Type: text/plain" \
  -H "Authorization: Bearer $(get-token)" \
  -d "Hello from the root conversation."
```

</CurlTest>

Example response:

```text
Sure, I can help with that.
```

Fetch the entry id to fork from:

<CurlTest steps={`
Then the response status should be 200
And set "FORK_ENTRY_ID" to the json response field "data[1].id"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/a8391789-592d-4273-90df-7349b08b5d3d/entries \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response from the entries API:

```json
{
  "data": [
    {
      "id": "f4f78014-a89a-40c6-8823-7144a4fb4b31",
      "conversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "channel": "history",
      "contentType": "history",
      "content": [{"role": "USER", "text": "Hello from the root conversation."}]
    }
  ]
}
```

Create a forked entry (this uses the Memory Service API directly so fork metadata can be passed in the request body).
Use a different conversation ID in the path (`6dcb8f3f-bd21-459f-9127-96e5a94d276c` below) than the root conversation ID:

<CurlTest steps={`
Then the response status should be 201
`}>

```bash
curl -sSfX POST http://localhost:8082/v1/conversations/6dcb8f3f-bd21-459f-9127-96e5a94d276c/entries \
  -H "Authorization: Bearer $(get-token)" \
  -H "X-API-Key: agent-api-key-1" \
  -H "Content-Type: application/json" \
  -d '{
    "channel": "history",
    "contentType": "history",
    "content": [{"role": "USER", "text": "Continue from this fork."}],
    "forkedAtConversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
    "forkedAtEntryId": "${FORK_ENTRY_ID}"
  }' | jq
```

</CurlTest>

Example response:

```json
{
  "id": "a0ce0657-87ce-45f6-a8c7-39beeb35fbe0",
  "conversationId": "6dcb8f3f-bd21-459f-9127-96e5a94d276c",
  "channel": "history",
  "contentType": "history",
  "content": [{"role": "USER", "text": "Continue from this fork."}]
}
```

List forks for the source conversation through the Spring proxy endpoint:

<CurlTest steps={`
Then the response status should be 200
And the response should contain "a8391789-592d-4273-90df-7349b08b5d3d"
And the response should contain "6dcb8f3f-bd21-459f-9127-96e5a94d276c"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/a8391789-592d-4273-90df-7349b08b5d3d/forks \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "data": [
    {
      "conversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "title": "Hello from the root conversation.",
      "createdAt": "2026-02-23T03:56:55.880524Z"
    },
    {
      "conversationId": "6dcb8f3f-bd21-459f-9127-96e5a94d276c",
      "forkedAtConversationId": "a8391789-592d-4273-90df-7349b08b5d3d",
      "title": "Continue from this fork.",
      "createdAt": "2026-02-23T03:57:31.598799Z"
    }
  ],
  "afterCursor": null
}
```

</TestScenario>


## Next Steps

- [Response Resumption](/docs/spring/response-resumption/) - Streaming responses with resume and cancel support.
- [Conversation Sharing](/docs/spring/sharing/) - Share conversations with other users.
- [Docker Compose Integration](/docs/spring/docker-compose/) - Automatic memory-service container startup for development and testing.
