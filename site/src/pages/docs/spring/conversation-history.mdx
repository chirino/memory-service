---
layout: ../../../layouts/DocsLayout.astro
title: Conversation History
description: Record conversation history and expose APIs for frontend applications.
---
import { Code } from 'astro:components';
import { PROJECT_VERSION } from '../../../config';
import CodeFromFile from '../../../components/CodeFromFile.astro';
import TestScenario from '../../../components/TestScenario.astro';
import CurlTest from '../../../components/CurlTest.astro';

This guide continues from [Getting Started](/docs/spring/getting-started/) and shows how to record conversation history and expose APIs for frontend applications.

## Prerequisites

**Starting checkpoint**: View the code from the previous section at [spring/examples/doc-checkpoints/02-with-memory](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/02-with-memory)

Make sure you've completed the [Getting Started](/docs/spring/getting-started/) guide first. You should have:
- A working Spring Boot agent with the Memory Service starter
- Memory Service running via Docker Compose
- OAuth2 authentication configured

## Understanding Memory vs History

There are two types of message storage in Memory Service:

- **Agent Memory** - Internal context window for the LLM, stored in the `memory` channel. This is what the agent uses to maintain context across messages.
- **Conversation History** - What users see in the UI, stored in the `history` channel. This records the actual messages exchanged between users and the agent.

In the previous guide, we only added agent memory. To display conversation history in a frontend UI, we need to also record history.

## Enable History Recording

The Memory Service starter provides `ConversationHistoryStreamAdvisorBuilder` which creates an advisor that automatically records user messages and agent responses to the `history` channel.

Update your controller to include the history advisor:

<CodeFromFile
  file="spring/examples/doc-checkpoints/03-with-history/src/main/java/com/example/demo/ChatController.java"
  lang="java"
/>

The `historyAdvisor` automatically records:
- User messages before calling the LLM
- Complete agent responses after the call completes

Run your agent again:

```bash
./mvnw spring-boot:run
```

<TestScenario checkpoint="spring/examples/doc-checkpoints/03-with-history">

Test it with curl:

<CurlTest steps={`
Then the response status should be 200
And the response body should be text:
"""
Sure! Here's a random number between 1 and 100: **42**.
"""
`}>

```bash
curl -NsSfX POST http://localhost:9090/chat/3579aac5-c86e-4b67-bbea-6ec1a3644942 \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $(get-token)" \
  -d "Give me a random number between 1 and 100."
```

</CurlTest>

</TestScenario>

This time when you browse to to the demo agent app at
[http://localhost:8080/?conversationId=3579aac5-c86e-4b67-bbea-6ec1a3644942](http://localhost:8080/?conversationId=3579aac5-c86e-4b67-bbea-6ec1a3644942)
you should see the messages that were exchanged between you and the agent.

## Expose Conversation APIs

The Memory Service starter auto-configures a `MemoryServiceProxy` bean that makes it easy to expose conversation APIs to your frontend. This helper handles authentication with the memory service and passes through the user's bearer token for authorization.

Create a REST controller that proxies requests to Memory Service:

<CodeFromFile
  file="spring/examples/doc-checkpoints/03-with-history/src/main/java/com/example/demo/MemoryServiceProxyController.java"
  lang="java"
/>

The `MemoryServiceProxy` also handles proper error handling and response mapping.

<TestScenario checkpoint="spring/examples/doc-checkpoints/03-with-history">

Test it with curl:

<CurlTest steps={`
Then the response status should be 200
And the response body should be json:
"""
{
  "id": "3579aac5-c86e-4b67-bbea-6ec1a3644942",
  "title": "%{response.body.title}",
  "ownerUserId": "bob",
  "createdAt": "%{response.body.createdAt}",
  "updatedAt": "%{response.body.updatedAt}",
  "lastMessagePreview": null,
  "accessLevel": "owner",
  "forkedAtEntryId": null,
  "forkedAtConversationId": null
}
"""
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/3579aac5-c86e-4b67-bbea-6ec1a3644942 \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "id": "3579aac5-c86e-4b67-bbea-6ec1a3644942",
  "title": "Give me a random number between 1 and 10",
  "ownerUserId": "bob",
  "createdAt": "2025-01-10T14:32:05Z",
  "updatedAt": "2025-01-10T14:32:06Z",
  "lastMessagePreview": null,
  "accessLevel": "owner",
  "forkedAtEntryId": null,
  "forkedAtConversationId": null
}
```

<CurlTest steps={`
Then the response status should be 200
And the response should contain "Give me a random number"
And the response should contain "history"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations/3579aac5-c86e-4b67-bbea-6ec1a3644942/entries \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "data": [
    {
      "id": "d15ab065-ab94-4856-8def-a040d6d2d9db",
      "conversationId": "3579aac5-c86e-4b67-bbea-6ec1a3644942",
      "userId": "bob",
      "channel": "history",
      "epoch": null,
      "contentType": "history",
      "content": [{"role": "USER", "text": "Give me a random number between 1 and 100."}],
      "createdAt": "2025-01-10T14:32:05Z"
    },
    {
      "id": "267158af-48bf-4000-b25b-c4f9932a48f4",
      "conversationId": "3579aac5-c86e-4b67-bbea-6ec1a3644942",
      "userId": "bob",
      "channel": "history",
      "epoch": null,
      "contentType": "history",
      "content": [{"role": "AI", "text": "Sure! Here's a random number between 1 and 100: **42**."}],
      "createdAt": "2025-01-10T14:32:06Z"
    }
  ],
  "nextCursor": null
}
```

</TestScenario>

You should see the conversation and entries that were exchanged between you and the agent.

## Expose Conversation Listing API

The `MemoryServiceProxyController` already includes the `listConversations` method (shown in the full code above). This endpoint supports:
- **Pagination** via `after` (cursor) and `limit` parameters
- **Search** via the `query` parameter for filtering conversations
- **Mode** for different listing modes (e.g., `owned`, `shared`)

<TestScenario checkpoint="spring/examples/doc-checkpoints/03-with-history">

Test it with curl:

<CurlTest steps={`
Then the response status should be 200
And the response should contain "3579aac5-c86e-4b67-bbea-6ec1a3644942"
And the response should contain "owner"
And the response should contain "bob"
`}>

```bash
curl -sSfX GET http://localhost:9090/v1/conversations \
  -H "Authorization: Bearer $(get-token)" | jq
```

</CurlTest>

Example response:

```json
{
  "data": [
    {
      "id": "3579aac5-c86e-4b67-bbea-6ec1a3644942",
      "title": "Give me a random number between 1 and 10",
      "ownerUserId": "bob",
      "createdAt": "2025-01-10T14:32:05Z",
      "updatedAt": "2025-01-10T14:32:06Z",
      "lastMessagePreview": null,
      "accessLevel": "owner"
    }
  ],
  "nextCursor": null
}
```

</TestScenario>

## Completed Checkpoint

**Completed code**: View the full implementation at [spring/examples/doc-checkpoints/03-with-history](https://github.com/chirino/memory-service/tree/main/spring/examples/doc-checkpoints/03-with-history)

## Next Steps

Continue to:
- [Indexing and Search](/docs/spring/indexing-and-search/) — Add search indexing and semantic search to your conversations
- [Conversation Forking](/docs/spring/conversation-forking/) — Branch conversations to explore alternative paths
- [Response Resumption](/docs/spring/response-resumption/) — Streaming responses with resume and cancel support
