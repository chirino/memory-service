apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

resources:
  - deployment.yaml
  - service.yaml
  - pvc.yaml

configMapGenerator:
  - name: memory-service-config
    behavior: merge
    literals:
      - MEMORY_SERVICE_DATASTORE_TYPE=mongo
      - QUARKUS_MONGODB_CONNECTION_STRING=mongodb://mongodb:27017/?directConnection=true
      - QUARKUS_MONGODB_DATABASE=memory_service
      - QUARKUS_MONGODB_CREDENTIALS_AUTH_SOURCE=admin
      # Dummy JDBC URL keeps Hibernate ORM's synthetic datasource bean active
      # (prevents InactiveBeanException). No actual PostgreSQL connection is made.
      - QUARKUS_DATASOURCE_JDBC_URL=jdbc:postgresql://unused:5432/unused
      - QUARKUS_DATASOURCE_JDBC_INITIAL__SIZE=0
      - QUARKUS_DATASOURCE_JDBC_MIN__SIZE=0
      - QUARKUS_DATASOURCE_JDBC_MAX__SIZE=1
      # Disable PostgreSQL Liquibase â€” migrations route to MongoDB Liquibase
      # via the DatastoreConfigSourceFactory.
      - QUARKUS_LIQUIBASE_MIGRATE_AT_START=false
      - QUARKUS_LIQUIBASE_VALIDATE_ON_MIGRATE=false

secretGenerator:
  - name: mongodb-secret
    literals:
      - MONGO_INITDB_ROOT_USERNAME=mongo
      - MONGO_INITDB_ROOT_PASSWORD=mongo
      - MONGO_INITDB_DATABASE=memory_service
      - keyfile=bW9uZ29kYnJlcGxpY2FzZXRrZXljaGFuZ2VtZWlucHJvZHVjdGlvbgo=
  - name: memory-service-secret
    behavior: merge
    literals:
      - QUARKUS_MONGODB_CREDENTIALS_USERNAME=mongo
      - QUARKUS_MONGODB_CREDENTIALS_PASSWORD=mongo
